# AstroTunes Backend - Django API

ุจฺฉโุงูุฏ Django ุจุฑุง ูพูุชูุฑู ุชูุฒุน ููุณู AstroTunes

## ูฺฺฏโูุง

### ๐ต ูุฏุฑุช ุชุฑฺฉโูุง
- ุขูพููุฏ ุชุฑฺฉ ููุณู ุชูุณุท ฺฉุงุฑุจุฑุงู
- ุจุฑุฑุณ ู ุชุงุฏ ุชุฑฺฉโูุง ุฏุฑ ูพูู ุงุฏูู Django
- ูุถุนุชโูุง ูุฎุชูู: ุฏุฑ ุงูุชุธุงุฑุ ุชุงุฏ ุดุฏูุ ุฑุฏ ุดุฏูุ ููุชุดุฑ ุดุฏู
- ุงูฺฉุงู ูุฑุงุด ู ูุฏุฑุช ฺฉุงูู ุฏุฑ ูพูู ุงุฏูู

### ๐ค ูุฏุฑุช ฺฉุงุฑุจุฑุงู ู ูุงู ููุฑ
- ุณุณุชู ุงุญุฑุงุฒ ููุช ฺฉุงูู (ุซุจุช ูุงูุ ูุฑูุฏุ ุฎุฑูุฌ)
- ูุงู ููุฑ ูุงุจู ุชูุธู ฺฉโุจุงุฑ (ูพุณ ุงุฒ ุงููู ุขูพููุฏ ููู ูโุดูุฏ)
- ฺฉุงุฑุจุฑุงู ุจุฏูู ุงุดุชุฑุงฺฉ: 1 ุชุฑฺฉ ุฑุงฺฏุงู
- ฺฉุงุฑุจุฑุงู ุจุง ุงุดุชุฑุงฺฉ: ุขูพููุฏ ูุงูุญุฏูุฏ

### ๐ณ ุณุณุชู ุงุดุชุฑุงฺฉ ู ูพุฑุฏุงุฎุช
- ูพุฑุฏุงุฎุช ฺฉุงุฑุช ุจู ฺฉุงุฑุช ุฏุณุช
- ููุฏูุง ูพุฑุฏุงุฎุช: ุชุงุฑุฎุ ุณุงุนุชุ ุดูุงุณู ูพฺฏุฑุ 4 ุฑูู ุขุฎุฑ ฺฉุงุฑุช
- ุชุงุฏ ูพุฑุฏุงุฎุช ุฏุฑ ูพูู ุงุฏูู
- ูุนุงูโุณุงุฒ ุฎูุฏฺฉุงุฑ ุงุดุชุฑุงฺฉ ูพุณ ุงุฒ ุชุงุฏ

### ๐ฏ ูพูู ุงุฏูู Django
- ูุฏุฑุช ฺฉุงูู ุชุฑฺฉโูุง
- ุชุงุฏ/ุฑุฏ ูพุฑุฏุงุฎุชโูุง
- ูุฏุฑุช ุทุฑุญโูุง ุงุดุชุฑุงฺฉ
- ูุฏุฑุช ฺฉุงุฑุจุฑุงู

## ูุตุจ ู ุฑุงูโุงูุฏุงุฒ

### ูพุดโูุงุฒูุง
- Python 3.8+
- pip

### ูุฑุงุญู ูุตุจ

1. **ูุตุจ ูุงุจุณุชฺฏโูุง**
```bash
cd backend
python -m venv venv

# ูุนุงูโุณุงุฒ ูุญุท ูุฌุงุฒ
# Windows:
.\venv\Scripts\Activate.ps1
# Linux/Mac:
source venv/bin/activate

pip install -r requirements.txt
```

2. **ุงุนูุงู Migrations**
```bash
python manage.py makemigrations
python manage.py migrate
```

3. **ุงุฌุงุฏ ุณููพุฑูุฒุฑ**
```bash
python manage.py createsuperuser
```

4. **ุงุฌุงุฏ ุฏุงุฏูโูุง ุงููู (ุงุฎุชุงุฑ)**
```bash
python manage.py shell
```

ุฏุฑ shell:
```python
from payments.models import PaymentMethod
from subscriptions.models import SubscriptionPlan

# ุงุฌุงุฏ ุฑูุด ูพุฑุฏุงุฎุช
PaymentMethod.objects.create(
    name="ฺฉุงุฑุช ุงุตู",
    card_number="6037997123456789",
    card_holder_name="ุนู ุงุญูุฏ",
    bank_name="ุจุงูฺฉ ูู",
    is_active=True
)

# ุงุฌุงุฏ ุทุฑุญ ุฑุงฺฏุงู
SubscriptionPlan.objects.create(
    name="Free",
    name_fa="ุฑุงฺฏุงู",
    price_irr=0,
    duration_days=365,
    max_tracks=1,
    is_active=True
)

# ุงุฌุงุฏ ุทุฑุญ ุญุฑููโุง
SubscriptionPlan.objects.create(
    name="Professional",
    name_fa="ุญุฑููโุง",
    price_irr=59900,
    duration_days=365,
    max_tracks=None,  # ูุงูุญุฏูุฏ
    has_pre_save=True,
    has_content_id=True,
    has_splits=True,
    has_analytics=True,
    has_shazam=True,
    has_store_maximizer=True,
    has_priority_support=True,
    is_active=True
)
```

5. **ุงุฌุฑุง ุณุฑูุฑ**
```bash
python manage.py runserver
```

ุณุฑูุฑ ุฑู `http://localhost:8000` ุงุฌุฑุง ูโุดูุฏ.

## API Endpoints

### ุงุญุฑุงุฒ ููุช
- `POST /api/auth/register/` - ุซุจุช ูุงู
- `POST /api/auth/login/` - ูุฑูุฏ
- `POST /api/auth/logout/` - ุฎุฑูุฌ
- `GET /api/auth/me/` - ุฏุฑุงูุช ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ
- `PUT /api/auth/me/` - ูุฑุงุด ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ
- `GET /api/auth/check-artist-name/` - ุจุฑุฑุณ ูุถุนุช ูุงู ููุฑ

### ุชุฑฺฉโูุง
- `GET /api/tracks/` - ูุณุช ุชุฑฺฉโูุง ฺฉุงุฑุจุฑ
- `POST /api/tracks/` - ุขูพููุฏ ุชุฑฺฉ ุฌุฏุฏ
- `GET /api/tracks/{id}/` - ุฌุฒุฆุงุช ุชุฑฺฉ
- `PUT /api/tracks/{id}/` - ูุฑุงุด ุชุฑฺฉ
- `DELETE /api/tracks/{id}/` - ุญุฐู ุชุฑฺฉ
- `GET /api/tracks/can_upload/` - ุจุฑุฑุณ ุงูฺฉุงู ุขูพููุฏ
- `GET /api/tracks/pending/` - ูุณุช ุชุฑฺฉโูุง ุฏุฑ ุงูุชุธุงุฑ (ุงุฏูู)
- `POST /api/tracks/{id}/approve/` - ุชุงุฏ ุชุฑฺฉ (ุงุฏูู)
- `POST /api/tracks/{id}/reject/` - ุฑุฏ ุชุฑฺฉ (ุงุฏูู)

### ุงุดุชุฑุงฺฉ ู ูพุฑุฏุงุฎุช
- `GET /api/subscription-plans/` - ูุณุช ุทุฑุญโูุง ุงุดุชุฑุงฺฉ
- `GET /api/payment-methods/` - ูุณุช ุฑูุดโูุง ูพุฑุฏุงุฎุช
- `GET /api/current-subscription/` - ุงุทูุงุนุงุช ุงุดุชุฑุงฺฉ ูุนู
- `GET /api/payments/payments/` - ูุณุช ูพุฑุฏุงุฎุชโูุง ฺฉุงุฑุจุฑ
- `POST /api/payments/payments/` - ุซุจุช ูพุฑุฏุงุฎุช ุฌุฏุฏ
- `GET /api/payments/payments/pending/` - ูุณุช ูพุฑุฏุงุฎุชโูุง ุฏุฑ ุงูุชุธุงุฑ (ุงุฏูู)
- `POST /api/payments/payments/{id}/approve/` - ุชุงุฏ ูพุฑุฏุงุฎุช (ุงุฏูู)
- `POST /api/payments/payments/{id}/reject/` - ุฑุฏ ูพุฑุฏุงุฎุช (ุงุฏูู)

## ูพูู ุงุฏูู Django

ุฏุณุชุฑุณ ุจู ูพูู ุงุฏูู: `http://localhost:8000/admin/`

### ุงูฺฉุงูุงุช ูพูู ุงุฏูู:

#### 1. ูุฏุฑุช ุชุฑฺฉโูุง
- ูุดุงูุฏู ูุณุช ุชูุงู ุชุฑฺฉโูุง
- ููุชุฑ ุจุฑ ุงุณุงุณ ูุถุนุชุ ููุน ุงูุชุดุงุฑุ ุฒุจุงู
- ูพุฎุด ุตูุช ู ูุดุงูุฏู ฺฉุงูุฑ
- ุชุงุฏ/ุฑุฏ ุฏุณุชูโุง ุชุฑฺฉโูุง
- ุงูุฒูุฏู ุงุฏุฏุงุดุช ุจุฑุง ูุฑ ุชุฑฺฉ

#### 2. ูุฏุฑุช ูพุฑุฏุงุฎุชโูุง
- ูุดุงูุฏู ุงุทูุงุนุงุช ฺฉุงูู ูพุฑุฏุงุฎุช
- ูุดุงูุฏู ุชุตูุฑ ุฑุณุฏ
- ุชุงุฏ ูพุฑุฏุงุฎุช ู ูุนุงูโุณุงุฒ ุฎูุฏฺฉุงุฑ ุงุดุชุฑุงฺฉ
- ุฑุฏ ูพุฑุฏุงุฎุช ุจุง ุฐฺฉุฑ ุฏูู

#### 3. ูุฏุฑุช ฺฉุงุฑุจุฑุงู
- ูุดุงูุฏู ูุณุช ฺฉุงุฑุจุฑุงู
- ุจุฑุฑุณ ูุถุนุช ูุงู ููุฑ (ููู/ุจุงุฒ)
- ูุฏุฑุช ุงุทูุงุนุงุช ูพุฑุฏุงุฎุช ฺฉุงุฑุจุฑุงู

#### 4. ูุฏุฑุช ุงุดุชุฑุงฺฉโูุง
- ุงุฌุงุฏ ุทุฑุญโูุง ุงุดุชุฑุงฺฉ ุฌุฏุฏ
- ูุนุงู/ุบุฑูุนุงู ฺฉุฑุฏู ุทุฑุญโูุง
- ูุดุงูุฏู ูุณุช ุงุดุชุฑุงฺฉโูุง ูุนุงู

## ูุฏูโูุง ุฏุชุงุจุณ

### User (ฺฉุงุฑุจุฑุงู)
- ุงุทูุงุนุงุช ูพุงู: ุงููุ ูุงู ฺฉุงุฑุจุฑุ ุฑูุฒ ุนุจูุฑ
- ูุงู ููุฑ (ูุงุจู ุชูุธู ฺฉโุจุงุฑ)
- ุขุฏุฑุณ ููุช USDT (ุจุฑุง ุฏุฑุงูุช ุฏุฑุขูุฏ)

### Track (ุชุฑฺฉโูุง)
- ุงุทูุงุนุงุช ุงูุชุดุงุฑ: ุนููุงูุ ูุงู ููุฑููุฏุ ุชุงุฑุฎ ุงูุชุดุงุฑ
- ูุงูโูุง: ุตูุชุ ฺฉุงูุฑ ุขุฑุช
- ูุชุงุฏุชุง: ฺุงูุฑุ ุฒุจุงูุ ุขููฺฏุณุงุฒุ ุดุงุนุฑ
- ูุถุนุช: pending, approved, rejected, published
- ูพูุชูุฑูโูุง ุงูุชุฎุงุจ

### Subscription (ุงุดุชุฑุงฺฉ)
- ฺฉุงุฑุจุฑ ู ุทุฑุญ ุงุดุชุฑุงฺฉ
- ุชุงุฑุฎ ุดุฑูุน ู ูพุงุงู
- ูุถุนุช ูุนุงู/ุบุฑูุนุงู

### Payment (ูพุฑุฏุงุฎุช)
- ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ ู ูุจูุบ
- ุงุทูุงุนุงุช ูุงุฑุฒ: ุชุงุฑุฎุ ุณุงุนุชุ ุดูุงุณู ูพฺฏุฑ
- ุชุตูุฑ ุฑุณุฏ
- ูุถุนุช: pending, approved, rejected

## ูุงุฌฺฉโูุง ฺฉูุฏ

### ูุญุฏูุฏุช ุขูพููุฏ
```python
# ฺฉุงุฑุจุฑ ุจุฏูู ุงุดุชุฑุงฺฉ: ููุท 1 ุชุฑฺฉ
# ฺฉุงุฑุจุฑ ุจุง ุงุดุชุฑุงฺฉ ูุนุงู: ูุงูุญุฏูุฏ
user.can_upload_track()  # ุจุฑุฑุณ ุงูฺฉุงู ุขูพููุฏ
```

### ููู ูุงู ููุฑ
```python
# ูพุณ ุงุฒ ุงููู ุขูพููุฏุ ูุงู ููุฑ ููู ูโุดูุฏ
user.lock_artist_name()
# ุชูุงุด ุจุฑุง ุชุบุฑ ููุฌุฑ ุจู ุฎุทุง ูโุดูุฏ
```

### ูุนุงูโุณุงุฒ ุงุดุชุฑุงฺฉ
```python
# ูพุณ ุงุฒ ุชุงุฏ ูพุฑุฏุงุฎุช ุฏุฑ ูพูู ุงุฏูู
payment.approve()  # ุงุดุชุฑุงฺฉ ุฎูุฏฺฉุงุฑ ูุนุงู ูโุดูุฏ
```

## ุงุชุตุงู ุจู Frontend

Frontend (Next.js) ุจุงุฏ ุจู ุขุฏุฑุณ `http://localhost:8000/api/` ุฏุฑุฎูุงุณุช ุจูุฑุณุชุฏ.

CORS ุจุฑุง `http://localhost:3000` ูุนุงู ุงุณุช.

### ูุซุงู ุฏุฑุฎูุงุณุช ุงุฒ Frontend:

```javascript
// ุซุจุช ูุงู
const response = await fetch('http://localhost:8000/api/auth/register/', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  credentials: 'include',
  body: JSON.stringify({
    username: 'artist1',
    email: 'artist@example.com',
    password: 'password123',
    password2: 'password123',
    artist_name: 'ููุฑููุฏ ุฌุฏุฏ'
  })
});

// ุขูพููุฏ ุชุฑฺฉ
const formData = new FormData();
formData.append('title', 'ุนููุงู ุขููฺฏ');
formData.append('audio_file', audioFile);
formData.append('cover_art', coverImage);
// ... ุณุงุฑ ููุฏูุง

const response = await fetch('http://localhost:8000/api/tracks/', {
  method: 'POST',
  credentials: 'include',
  body: formData
});
```

## ูฺฉุงุช ุงููุช

1. **ุฏุฑ production:**
   - `DEBUG = False` ุชูุธู ฺฉูุฏ
   - `SECRET_KEY` ุฑุง ุชุบุฑ ุฏูุฏ
   - `ALLOWED_HOSTS` ุฑุง ุชูุธู ฺฉูุฏ
   - ุงุฒ HTTPS ุงุณุชูุงุฏู ฺฉูุฏ

2. **ูุญุงูุธุช ุงุฒ ูุงูโูุง:**
   - ูุงูโูุง media ุฏุฑ production ุฑู ฺฉ storage ุงูู ูุฑุงุฑ ฺฏุฑูุฏ
   - ุงุฒ CDN ุจุฑุง ุณุฑู ูุงูโูุง ุจุฒุฑฺฏ ุงุณุชูุงุฏู ุดูุฏ

## ูพุดุชุจุงู

ุจุฑุง ุณูุงูุงุช ู ูุดฺฉูุงุชุ ุจู ูุณุชูุฏุงุช Django ูุฑุงุฌุนู ฺฉูุฏ:
- https://docs.djangoproject.com/
- https://www.django-rest-framework.org/

## ูุฌูุฒ

ุงู ูพุฑูฺู ุจุฑุง ุงุณุชูุงุฏู ุดุฎุต AstroTunes ุณุงุฎุชู ุดุฏู ุงุณุช.

